# API规范
1. 数据通信格式采用json传输
1. 所有数据采用UTF8编码
1. 方法参数名采用下划线和全小写格式

## 接口规范

| 请求类型 | HTTP | 参数格式 | 实例 |
| :----: | ---- | ---- | ---- |
| 查询 | POST | MAP(标准请求参数 + 业务数据) | https://api.x.com/fn?token=1234567890&userid=111 |
| [提交](#提交接口设计) | POST | MAP(标准请求参数)+JSON(业务数据) | https://api.x.com/fn?token=1234567890, body: {} |

## 标准请求参数
* 报文请求头字段
| 参数 | 名称 | 说明 |
| :----: | ---- | ---- |
| sign | 签名 |  |
| token | 用户令牌 | 登录后才有 |
| [client](#请求方信息结构) | 请求方信息结构 |  |

* 业务字段
| 参数 | 名称 | 说明 |
| :----: | ---- | ---- |
| requestId | 请求号 |  |
| method | 函数 |  |
| ver | 版本 |  |

### GET模式
```
curl -X GET 'https://api.x.com/fn?requestId=135213&&ver=1.0'
```

### POST模式
```
curl -H "Content-type: application/json" -X POST -d '{"requestId":135213, "method":"fn", "ver":"1.0"}' 'https://api.x.com/'
```

## 标准返回参数

| 参数 | 名称 | 说明 | 必须 |
| :----: | ---- | ---- | ---- |
| requestId | 请求号 |  | Y |
| beginTime | 开始时间 | 时间戳 | Y |
| endTime | 结束时间 | 时间戳 | Y |
| sign | 签名 |  | Y |
| [code](exception#返回码) | 返回码 |  | Y |
| data | 结果 | json对象，成功返回业务数据，PARAM_ERROR时返回错误PARAM清单 | Y |
| verbose | 异常信息(堆栈) | 异常特有 | (非生产环境 OR (生产环境 AND 未知错误)) |

```
{"requestId":135213, "beginTime":1650868552, "endTime":1650868552, "code":0, "data":{"result":1}}
```

# 参考
## 方法格式
格式：entity/operation，如user/get

## 请求方信息结构
* 结构：系统-设备-设备号-运行环境容器-版本
* 示例：taihang/taihang_boss-iOS-UUID-MobileBrowser-2.8.20.1495017
* 枚举
  * 设备：Android iOS Pc
  * 运行环境容器：MobileBrowser(手机浏览器), WXBrowser(手机微信浏览器), APP(客户端)]

## 提交接口设计
* 实体及其数组属性(如我的地址)都使用本方案

| 操作 | ID | 提交数据 |
| :----: | ---- | ---- |
| 新增 | 无 | 有 |
| 修改 | 有 | 增量(修改部分)，全量(时间戳) |
| 删除 | 有 | 无 |

* 增量修改：如修改期间有其他人修改了同一个属性，则会提示确认。
```Java
update(老数据, 增量新数据, 强制修改) {
    if (!强制修改 && 当前数据 != 老数据) // 不强制修改 && 数据有改变
      return "数据有调整(当前数据, 老数据, 增量新数据)，确定修改吗？"

    修改成新数据
}
```

* 全量修改：基于实体时间戳，如修改期间有其他人修改了同一个实体，则会提示确认。
```Java
update(老数据.时间戳, 全量新数据, 强制修改) {
    if (!强制修改 && 当前数据.时间戳 != 老数据.时间戳) // 不强制修改 && 数据时间戳有改变
      return "数据有调整(当前数据, 老数据, 全量新数据)，确定修改吗？"

    修改成新数据，同时更新数据时间戳
}
```
