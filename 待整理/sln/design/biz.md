# 业务设计

# 验证码
## 设计
1. 采用缓存实现，所有参数配置在service，不配置则使用默认值
1. 支持发送和发送管理(周期性次数控制)，如1天内1个手机不能发超过10次验证码

### 发送
* 分组：CAPTCHA，key：业务类型_编号，如"忘记密码_手机号"，"修改密码_用户号"
* 信息：有效期(缓存自带)，验证码。
* 无需删除，自动过期即可

### 发送管理
* 分组：CAPTCHA_CTRL，key：业务类型_编号
* 信息：有效期(缓存自带)，允许次数，当前次数。

## 流程
### 发送
```
if ("发送管理" 存在) {
    if (当前次数 >= 允许次数)
        return 返回码(超过次数)
}

新建 "发送"
发送短信
新建或修改 "发送管理"
if (当前次数 > 允许次数 - 2)
    msg = 只剩下3次
return 返回码(发送成功)
```

### 业务类型
| 业务类型 | 功能 | 参数 |
| :----: | ---- | ---- |
| 忘记密码(FORGET_PASSWORD) | 发送 | 有效期: 1小时 |
| 忘记密码(FORGET_PASSWORD) | 发送管理 | 有效期: 今天的12PM。次数阈值: 10 |

# 信息发送记录
* 各种短信(不止验证码)的发送记录和统计
* 用表，暂不做
