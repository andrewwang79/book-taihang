# 系统架构规划
## 目标
1. 支持私有化部署和云部署
1. 可不停加入/降级服务功能
1. 系统可治理：配置，日志，报警等

## 方案
### 代码重构
清洗，分层，解耦
UT
### 架构升级
1. 业务：基于技术逐步迁移，用测试和UT降低风险
1. 技术
  1. 现代化
  1. 微服务
  1. 大数据

## 设计
1. 2周可行性分析和搭建
1. 时间长(3个月)建议直接上spring cloud
1. dubbo无缝切换到springcloud的方案

### 技术选择
| 技术 | 当前 | 采用 | 说明 |
| :----: | ---- | ---- |
| 容器化 | 无 | docker | 部署时间和成本极低 |
| 微服务 | dubbo | spring cloud | 生态链，有整体解决方案，治理方便 |
| 脚手架 | spring | spring boot |  |
| 持久化框架 | mybatis | spring jpa | 多种数据源支持，还支持hadoop等 |
| 通用服务 | 无 | taihang？ |  |
| 配置 | 无 | zookeeper |  |
| 开发日志 | 无 | ELK |  |

# 当前架构改进清单
## 新增
文件读写压力：预处理
多数据源连接，连接池

## 改进
MQ单线程优化成多线程，需要逻辑代码先改成多线程兼容。
zk重启会无效，会自动重新注册吗
分布式缓存？cacheVersion做不到吧
生成一个异常流水号，追加到错误消息上显示到前端用户，用户反馈问题时给出此流水号给运维或开发人员快速定位对应具体异常细节

## 其他
### 时间格式
三种：date，到秒的time，时间戳
