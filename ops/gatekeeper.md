# 功能逐级发布
facebook的机制, gatekeeper

## 方案
* 本质上是个功能的路由器，可重定向，可关闭。
* 每个功能都有发布级别，上下线
* 分流控制：可指定特定地域，用户级别等
* 每个发布控制点关联一个功能编码
* 功能的发布级别是可以管理配置的。支持手工调整和自动调整(如3天升一级)
* 用户选择随机性确保：功能编码做随机数种子。

## 发布级别

| 级别 | 范围 | 说明 |
| :----: | ---- | ---- |
| 1 | 测试人员 |  |
| 2 | 公司内部 | 内测 |
| 3 | 1% | 外部小范围 |
| 4 | 5% | 外部大范围 |
| 5 | 100% | 发布 |

## 流程
* 前端一次性下载(周期性更新)：用户级别，功能级别(发布中的功能，不是全部功能)。
* 用户级别足够，则显示功能，否则隐藏。

## 参考
[AB测试和灰度发布平台架构设计和实践](http://doc.mbalib.com/view/1622be0db26dc1400284e0ea95fd2f80.html)
