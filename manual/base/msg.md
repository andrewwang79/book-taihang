# 消息持久化和通知推送
* 所有的都是消息，通知是因用户交互产生的(下单，订阅)
* 推送是种信息传输方式，有短信，邮件，app，微信等

## 通知推送原则
1. 推送渠道
  1. 有来源渠道(推送回来源渠道)，比如微信下单，微信通知。需业务记录渠道号(如订单记录渠道是微信)
  1. 来源渠道没有时，推送到常用渠道(通过记录用户登录和日常使用，来获取)
1. 部分通知必须同时短信通知。如重要的，后续用户需要使用到的。

## 持久化
每个消息有持久化模板，通过消息表持久化(用户编号，消息分类，已读，status，标题，内容，网址)
逻辑：
if(持久化) {
  消息.标题 = format(持久化模板)
  save 消息 to 消息表
}

## 短信短地址的处理
短地址对应的页面：有打开app、下载app、关注APP。
打开app时会将业务参数传入app，这样app打开时自动到了特定业务页面。

# 我的消息-未读数量
## 需求
在底部按钮和”消息中心“(个人中心页)都需要显示未读状态。

## 方案
* 以上两个页面都是需要缓存的页面，实时后端获取导致性能很差。
* 通过缓存来保存未读数量。不要每次到状态显示时，都实时去后端获取。

触发获取数据的条件
1. 系统启动时：异步获取未读数量
1. 消息中心页：通过消息列表API，同步获取未读数量
1. 消息详细页：通过消息已读API，同步获取未读数量
1. 个人中心页(可选)：异步获取未读数量
