# 实体通用属性的适用场景
| 属性 | 适用场景 | 例子 | 反例 |
| :----: | ---- | ---- | ---- |
| CreateTime | 关注时间的 | 订单 | 键值 |
| Status | 有状态的，支持逻辑删除的 | 商品 | 公式 |

# kv持久化
* keyValue持久化表(kv)，有过期时间。
* 如有重复则重新生成key(可以不用锁，冲突概率忽略不计)。
```
if (key exist)
    return false;
else
    insert to kv table
```

# 获取点位周边的poi
## 优劣分析
* 常规方法是直接计算点和点之间的距离。精准度高，但计算量大。
* 网格化的计算量小，显示误差是网格长度(如10米)。如误差容忍度更高，可以将网格调整的更高。

## 算法
### 遍历全部
傻算

### 距离
* 建立距离表：点，信息，距离(米，存储距离是2千米以内的数据)
* 在点或者信息有CUD时，更新距离表
* 附近信息可以快速通过距离表获取

### 网格化
* 地图按照10米一格，做成网络。信息要有对应的网格。一个网格里的每个信息和点的距离是一样的。
* 基于点算出距离内所有的网格，获取所有符合条件网格的信息。搜索匹配。

例子：起点121.234234，10米一格，100个网格。第一个网格是[121.234234,121.234235),网格名称是121.234234
* 格子数量估算：按照以下估算计算量也不少，不建议使用本方案。
* 半径是100米：格宽度是50米，则需要8个格子。格宽度是20米，则需要40个？格子。
* 半径是1000米：格宽度是50米，则需要800个？格子。二次方。

### 选定区域后计算
* 选择点是中心的正方形（边长是2个半径），选出处于正方形区域内的信息，再排除超过半径的信息。这样可以大量减少计算量。
* 本方案还可优化，比如先选择边长是一个半径的正方形区域先计算。但如果没有动态实时需求，不建议优化，使用缓存即可有大提升。

## 参考
* 二维环境，点位是否在区域里的判断方法:
用百度接口判断。[GeoUtils示例](http://api.map.baidu.com/library/GeoUtils/1.2/examples/simple.html)，[GeoUtils的API](http://api.map.baidu.com/library/GeoUtils/1.2/docs/symbols/BMapLib.GeoUtils.html)
* 二维环境，点位在哪个区域里的判断方法:
在未知情况下的判断。
  1. 人工从地图上标出区域边界线（参考[画线/区域工具](http://www.cnblogs.com/milkmap/archive/2012/02/23/2365064.html)）
  1. 将标出的区域网格化（具体粒度待定，算法未定）
  1. 根据目标点位的坐标去查询所属网格，通过网格知道所在区域

* [判断点在多边形内的算法](http://www.w2bc.com/Article/8717)
* [获取坐标工具](http://api.map.baidu.com/lbsapi/getpoint/index.html)
* [获取中国行政区域的边界（最小到”区/县”）](http://www.cnblogs.com/milkmap/archive/2012/04/11/2442430.html)


# 组合枚举
* [资料](http://blog.csdn.net/zhouqinghe24/article/details/8243679)
* 常规枚举：单选模式。
* 组合枚举：多选模式。值是2的倍数，可同时有多个枚举值。比如3就是选择了1和2。
```
enum Styles {  
ShowBorder = 1,         //是否显示边框
ShowCaption = 2,        //是否显示标题
ShowToolbox = 4         //是否显示工具箱
}
```

# 数据导入导出
* 都在内存操作，不需要存储到文件系统。
* 导入：前端输入导入文件，后端直接在内存里用模板文件生成。模板文件在类启动时自动加载到内存。
* 导出：前端输入查询条件，后端获取数据，返回内存文件。

# 图片上传
支持图片多选/单选，编辑

方案：
1. 七牛组件
1. 自建
  1. app：前端调用原生选图编辑图。原生提交编辑后的图片本地路径到前端，前端上传到后端，后端处理后返回图片地网址给前端。
  1. 微信：用js组件

# emoji
[资料](http://blog.csdn.net/ugg/article/details/44225723)

# 第三方二维码图片
* [使用说明](http://www.liantu.com/pingtai/)
* 图片地址示例：http://qr.liantu.com/api.php?text=http://www.xyz.com/shop/1111

# 离线缓存
* 首页有默认页面(默认数据)
* 方案
  * 参考PWA
  * 接口：获取(是否缓存)，网络改变通知(有和无)。
    首次数据不会有lastindex。
  * 微信内的网络改变的获取方法：是否能获取网络数据，比如百度的

# 数据删除原则
* 商业数据
  * 商业用户一般情况下不允许删除数据。
  * 不能删除，只有关闭，取消等。
  * 商城里订单，用户可以删除已完成的订单，其本质是隐藏(不是删除)，因为商户还要做订单统计。
* 个人数据
  * 个人用户删除数据的情况比较常见。
  * 可删除。删除后尽量保留价值数据用于数据分析。

# 重复点击
* 将提交内容的md5结果，作为资源锁定。
* 在锁定期间的后续重复请求自动返回无效。

# [微信连Wifi](http://wifi.weixin.qq.com/)
