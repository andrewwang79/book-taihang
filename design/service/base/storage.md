# 存储服务

系统环境（测试和正式）各自有域名和存储空间。定好后不能改变。

1. 存储空间使用规范
  1. 正式存储空间：静态文件（如logo，加载中等），正式的动态数据（如cms，广告等）
  1. 测试存储空间：测试的动态数据
1. 所有db内的url必须是绝对地址

# 冗余存储文件处理
* 冗余说明：文件上传了，但最后没有用到，放弃了。
* 冗余实例：修改头像时，未保存的文章，草稿文章删除，文章删除。

## 方案(未考虑删除)：
1. 实时操作
  1. 标识模式：文件先上传，文件标识成临时使用。在“保存”时标识成永久使用。
  1. 数量模式：文件先上传，文件使用数是0。在“保存”时使用数+1。缺陷：要精准使用数成本太高。
  1. 临时目录模式：文件先上传到存储系统的临时目录，在“保存”时迁移到正式目录。缺陷：迁移的同时需要修改文件url；用户需要重开编辑界面编辑(临时文件url已经无效)；临时的需打标签。
1. 周期清理
  1. 列出所有使用到的存储文件，比对存储系统上的列表。清理差异。缺陷：不适用于大型系统。

## 流程
1. 前端设置两个路径，前端/后端返回存储服务的路径清单。
1. 前端/后端比对路径差异，差异文件上传到存储服务。
1. 刷新存储服务的CDN。

## 七牛说明
七牛支持给每个文件附加数据
